<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mapping sensors and data with OpenLayers 3 &mdash; istSOS 2.3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="istSOS 2.3.1 documentation" href="index.html" />
    <link rel="next" title="MQTT Broadcasting" href="ws_mqtt.html" />
    <link rel="prev" title="Creating Virtual Procedures" href="ws_virtualprocedures.html" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42669175-5', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ws_mqtt.html" title="MQTT Broadcasting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ws_virtualprocedures.html" title="Creating Virtual Procedures"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">istSOS 2.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mapping-sensors-and-data-with-openlayers-3">
<span id="ws-mapping"></span><h1>Mapping sensors and data with OpenLayers 3<a class="headerlink" href="#mapping-sensors-and-data-with-openlayers-3" title="Permalink to this headline">¶</a></h1>
<p>In the Tutorial/ol-examples folder you can find some examples using
OpenLayers 3 (<a class="reference external" href="http://openlayers.org/">http://openlayers.org/</a>).</p>
<p>Copy the code in your istsos installation folder by executing:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo cp -r ~/Desktop/Tutorial/ol-examples /usr/share/istsos/interface/modules/ol-examples
</pre></div>
</div>
<ul>
<li><div class="first line-block">
<div class="line"><strong>Example 1</strong></div>
<div class="line">A simple OpenLayer 3 example with an OpenStreetMap basemap and a GeoJSON Vector overlay showing sensor’s position.</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/modules/ol-examples/example-1.html">http://localhost/istsos/modules/ol-examples/example-1.html</a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Example 2</strong></div>
<div class="line">Example 1 + Styling</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/modules/ol-examples/example-2.html">http://localhost/istsos/modules/ol-examples/example-2.html</a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Example 3</strong></div>
<div class="line">Example 2 + Mouse click interaction displaying sensor’s metadata</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/modules/ol-examples/example-3.html">http://localhost/istsos/modules/ol-examples/example-3.html</a></div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>Example 4</strong></div>
<div class="line">Example 3 + Chart plot of last week of data</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/modules/ol-examples/example-4.html">http://localhost/istsos/modules/ol-examples/example-4.html</a></div>
</div>
</li>
</ul>
<div class="section" id="practice-with-openlayers-3">
<h2>Practice with OpenLayers 3<a class="headerlink" href="#practice-with-openlayers-3" title="Permalink to this headline">¶</a></h2>
<p>If you want make some practice, we have prepared a file from which to begin
to do some practice, let’s go to:</p>
<p><a class="reference external" href="http://localhost/istsos/modules/ol-examples/practice.html">http://localhost/istsos/modules/ol-examples/practice.html</a></p>
<p>Open the file practice.html so we can start..</p>
<p>If installed from source</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo gedit /usr/local/istsos/interface/modules/ol-examples/practice.html
</pre></div>
</div>
<p>If installed from debian package</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo gedit /usr/share/istsos/interface/modules/ol-examples/practice.html
</pre></div>
</div>
<p>Here an overview of the file that we have prepared. A simple OpenLayer 3
example with a OpenStreetMap basemap.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;ol/ol.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;ol/ol-debug.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;style&gt;</span>
      <span class="nf">#map</span> <span class="p">{</span>
        <span class="k">width</span><span class="o">:</span> <span class="m">600px</span><span class="p">;</span>
        <span class="k">height</span><span class="o">:</span> <span class="m">400px</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;map&quot;</span> <span class="na">class=</span><span class="s">&quot;map&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;script&gt;</span>
          <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
            <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
              <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
                <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">OSM</span><span class="p">()</span>
              <span class="p">})</span>
            <span class="p">],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
            <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
              <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">1614350</span><span class="p">,</span> <span class="mi">6168773</span><span class="p">],</span>
              <span class="nx">zoom</span><span class="o">:</span> <span class="mi">5</span>
            <span class="p">})</span>
          <span class="p">});</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-istsos-sensors-on-the-map">
<h2>Loading istSOS sensors on the map<a class="headerlink" href="#loading-istsos-sensors-on-the-map" title="Permalink to this headline">¶</a></h2>
<p>The istSOS WA REST exposes a request to retrieve a GeoJSON file including all
the sensors offered by a istSOS instance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="line-block">
<div class="line">Try to load the GeoJSON:</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/wa/istsos/services/demo/procedures/operations/geojson">http://localhost/istsos/wa/istsos/services/demo/procedures/operations/geojson</a></div>
</div>
<div class="last line-block">
<div class="line">You can also execute a reprojection by adding the epsg parameter:</div>
<div class="line"><a class="reference external" href="http://localhost/istsos/wa/istsos/services/demo/procedures/operations/geojson?epsg=3857">http://localhost/istsos/wa/istsos/services/demo/procedures/operations/geojson?epsg=3857</a></div>
</div>
</div>
<p>To add the istSOS layer is quite simple. You have to create a Vector Layer with
a Vector Source. And the source have to be configured defining the format
(as GeoJSON) and the url (from where to download the GeoJSON data)</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
    <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">OSM</span><span class="p">()</span>
        <span class="p">}),</span>
<span class="hll">        <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Vector</span><span class="p">({</span>
</span><span class="hll">            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">Vector</span><span class="p">({</span>
</span><span class="hll">                <span class="nx">format</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">(),</span>
</span><span class="hll">                <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;../../wa/istsos/services/demo/procedures/operations/geojson?epsg=4326&#39;</span>
</span><span class="hll">            <span class="p">})</span>
</span><span class="hll">        <span class="p">})</span>
</span>    <span class="p">],</span>
    <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
    <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
        <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">1614350</span><span class="p">,</span> <span class="mi">6168773</span><span class="p">],</span>
        <span class="nx">zoom</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="changing-the-istsos-vector-layer-style">
<h2>Changing the istSOS vector layer style<a class="headerlink" href="#changing-the-istsos-vector-layer-style" title="Permalink to this headline">¶</a></h2>
<p>Modify code as shown in the next box, defining a custom style:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
    <span class="nx">layers</span><span class="o">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Tile</span><span class="p">({</span>
            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">OSM</span><span class="p">()</span>
        <span class="p">}),</span>
        <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">layer</span><span class="p">.</span><span class="nx">Vector</span><span class="p">({</span>
            <span class="nx">source</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">Vector</span><span class="p">({</span>
                <span class="nx">format</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">(),</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;../../wa/istsos/services/demo/procedures/operations/geojson?epsg=4326&#39;</span>
            <span class="p">}),</span>
<span class="hll">            <span class="nx">style</span><span class="o">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Style</span><span class="p">({</span>
</span><span class="hll">                <span class="nx">image</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Circle</span><span class="p">({</span>
</span><span class="hll">                    <span class="nx">radius</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span class="hll">                    <span class="nx">fill</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Fill</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;green&#39;</span><span class="p">}),</span>
</span><span class="hll">                    <span class="nx">stroke</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">Stroke</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span>
</span><span class="hll">                <span class="p">})</span>
</span><span class="hll">            <span class="p">})]</span>
</span>        <span class="p">})</span>
    <span class="p">],</span>
    <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
    <span class="nx">view</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span>
    <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mi">1614350</span><span class="p">,</span> <span class="mi">6168773</span><span class="p">],</span>
    <span class="nx">zoom</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>Reload (F5) the web page on the browser</p>
</div>
<div class="section" id="adding-interaction-to-the-map-to-display-sensor-metadata">
<h2>Adding interaction to the map to display sensor metadata<a class="headerlink" href="#adding-interaction-to-the-map-to-display-sensor-metadata" title="Permalink to this headline">¶</a></h2>
<p>Append after the map initialization this code to enable the
&#8220;ol.interaction.Select&#8221; feature:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
  <span class="c1">// {...}</span>
<span class="p">});</span>
<span class="c1">// {...}</span>

<span class="hll"><span class="c1">// select interaction working on &quot;singleclick&quot;</span>
</span><span class="hll"><span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">interaction</span><span class="p">.</span><span class="nx">Select</span><span class="p">({</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">// Add the interaction to the map</span>
</span><span class="hll"><span class="nx">map</span><span class="p">.</span><span class="nx">addInteraction</span><span class="p">(</span><span class="nx">select</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll"><span class="c1">// Listen for select event</span>
</span><span class="hll"><span class="nx">select</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">    <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">selected</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class="hll">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">selected</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">c</span><span class="o">++</span><span class="p">){</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
</span><span class="hll">        <span class="nx">html</span> <span class="o">+=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span> <span class="o">+</span>
</span><span class="hll">            <span class="s2">&quot;Begin: &quot;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">samplingTime</span><span class="p">.</span><span class="nx">beginposition</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span> <span class="o">+</span>
</span><span class="hll">            <span class="s2">&quot;End: &quot;</span> <span class="o">+</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">samplingTime</span><span class="p">.</span><span class="nx">endposition</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span> <span class="o">+</span>
</span><span class="hll">            <span class="s2">&quot;Observed properties:&lt;br/&gt;&quot;</span> <span class="p">;</span>
</span><span class="hll">        <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;ol&gt;&quot;</span><span class="p">;</span>
</span><span class="hll">        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">observedproperties</span><span class="p">;</span>
</span><span class="hll">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">cnt</span> <span class="o">&lt;</span> <span class="nx">op</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">cnt</span><span class="o">++</span><span class="p">){</span>
</span><span class="hll">            <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;li&gt;&quot;</span> <span class="o">+</span> <span class="nx">op</span><span class="p">[</span><span class="nx">cnt</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/li&gt;&quot;</span><span class="p">;</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">        <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ol&gt;&lt;hr/&gt;&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;details&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
</span><span class="hll"><span class="p">});</span>
</span></pre></div>
</td></tr></table></div>
<p>Reload (F5) the web page on the browser and click on a point displayed on
the map. Sensor details will be displayed in the details div.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you want to display other properties using the feature.getProperties()
function, this are the attributes that can be accessed:</p>
<div class="last highlight-json"><div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;samplingTime&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;beginposition&quot;</span><span class="p">:</span> <span class="s2">&quot;2007-01-01T00:00:00+0100&quot;</span><span class="p">,</span>
        <span class="nt">&quot;endposition&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-12-31T23:50:00+0100&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;sensortype&quot;</span><span class="p">:</span> <span class="s2">&quot;insitu-fixed-point&quot;</span><span class="p">,</span>
    <span class="nt">&quot;observedproperties&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;water-height&quot;</span><span class="p">,</span>
            <span class="nt">&quot;uom&quot;</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;A_AETCAN_AIR&quot;</span><span class="p">,</span>
    <span class="nt">&quot;assignedid&quot;</span><span class="p">:</span> <span class="s2">&quot;8c4b9c18d464493568cfb18d015bbed5&quot;</span><span class="p">,</span>
    <span class="nt">&quot;offerings&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;temporary&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">51</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plotting-measures-in-a-chart">
<h2>Plotting measures in a chart<a class="headerlink" href="#plotting-measures-in-a-chart" title="Permalink to this headline">¶</a></h2>
<p>The example-4.html (<a class="reference external" href="http://localhost/istsos/modules/ol-examples/example-4.html">http://localhost/istsos/modules/ol-examples/example-4.html</a>)
is a little bit more for advanced user. Take a look a the code, here you can
see how to plot observation measurements with the support of some well known
JavaScript library: JQuery with MIT license (<a class="reference external" href="https://jquery.com">https://jquery.com</a>) and
Highcharts with a non-commercial license (<a class="reference external" href="http://www.highcharts.com">http://www.highcharts.com</a>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Highcharts is one of the prettiest interactive charts on the web,
unfortunately the licence is not from the FOSS family. But you can
use the software for free under the non-commercial license.</p>
<p class="last">More info on non-commercial licensing can be found here:
<a class="reference external" href="http://shop.highsoft.com/faq/non-commercial#what-is-non-commercial">http://shop.highsoft.com/faq/non-commercial#what-is-non-commercial</a></p>
</div>
<div class="figure">
<img alt="_images/charting.png" src="_images/charting.png" />
</div>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// select interaction working on &quot;singleclick&quot;</span>
<span class="kd">var</span> <span class="nx">select</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ol</span><span class="p">.</span><span class="nx">interaction</span><span class="p">.</span><span class="nx">Select</span><span class="p">({</span><span class="nx">multi</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>

<span class="c1">// Add the interaction to the map</span>
<span class="nx">map</span><span class="p">.</span><span class="nx">addInteraction</span><span class="p">(</span><span class="nx">select</span><span class="p">);</span>

<span class="c1">// Listen for select event</span>
<span class="nx">select</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">selected</span><span class="p">,</span>
        <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">selected</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">c</span><span class="o">++</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">feature</span> <span class="o">=</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">name</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">begin</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">samplingTime</span><span class="p">.</span><span class="nx">beginposition</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">samplingTime</span><span class="p">.</span><span class="nx">endposition</span><span class="p">;</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;Begin: &quot;</span> <span class="o">+</span> <span class="nx">begin</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;End: &quot;</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&lt;br/&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;Observed properties:&lt;br/&gt;&quot;</span> <span class="p">;</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;ol&gt;&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>
        <span class="nx">begin</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>
        <span class="nx">begin</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">7</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">op</span> <span class="o">=</span> <span class="nx">feature</span><span class="p">.</span><span class="nx">getProperties</span><span class="p">().</span><span class="nx">observedproperties</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">cnt</span> <span class="o">&lt;</span> <span class="nx">op</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">cnt</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;li&gt;&lt;a href=&#39;javascript:chart(\&quot;&quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;\&quot;,\&quot;&quot;</span><span class="o">+</span><span class="nx">begin</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;\&quot;,\&quot;&quot;</span><span class="o">+</span><span class="nx">end</span><span class="o">+</span><span class="s2">&quot;\&quot;,\&quot;&quot;</span><span class="o">+</span><span class="nx">op</span><span class="p">[</span><span class="nx">cnt</span><span class="p">].</span><span class="nx">def</span><span class="o">+</span><span class="s2">&quot;\&quot;);&#39;&gt;&quot;</span> <span class="o">+</span> <span class="nx">op</span><span class="p">[</span><span class="nx">cnt</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/ol&gt;&lt;hr/&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;details&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">chart</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">observedProperty</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;../../wa/istsos/services/demo/operations/getobservation/offerings/temporary/procedures/&#39;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s1">&#39;/observedproperties/&#39;</span><span class="o">+</span><span class="nx">observedProperty</span><span class="o">+</span><span class="s1">&#39;/eventtime/&#39;</span><span class="o">+</span><span class="nx">begin</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">end</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">sosData</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">result</span><span class="p">.</span><span class="nx">DataArray</span><span class="p">.</span><span class="nx">values</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">result</span><span class="p">.</span><span class="nx">DataArray</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">sosData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">c</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">c</span><span class="o">++</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">sosData</span><span class="p">[</span><span class="nx">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="o">+</span><span class="nx">date</span><span class="p">,</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">sosData</span><span class="p">[</span><span class="nx">c</span><span class="p">][</span><span class="mi">1</span><span class="p">])]);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chart&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chart&#39;</span><span class="p">).</span><span class="nx">highcharts</span><span class="p">(</span><span class="s1">&#39;StockChart&#39;</span><span class="p">,{</span>
            <span class="nx">rangeSelector</span> <span class="o">:</span> <span class="p">{</span>
                <span class="nx">selected</span> <span class="o">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">text</span> <span class="o">:</span> <span class="nx">name</span>
            <span class="p">},</span>
            <span class="nx">subtitle</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">text</span><span class="o">:</span> <span class="nx">field</span><span class="p">.</span><span class="nx">definition</span>
            <span class="p">},</span>
            <span class="nx">yAxis</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">text</span><span class="o">:</span> <span class="nx">field</span><span class="p">.</span><span class="nx">name</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nx">tooltip</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">valueDecimals</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="nx">formatter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">date</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span> <span class="o">+</span>
                        <span class="nx">field</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">field</span><span class="p">.</span><span class="nx">uom</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nx">series</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
                <span class="nx">labels</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">formatter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s2">&quot; - stic&quot;</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}]</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="index.html"><img src="_static/logo.png" border="0" alt="istSOS" align="centre" width="200"/></a>
<hr>
<a href="https://sourceforge.net/projects/istsos/files/" align="centre">Download istSOS</a>
<hr>

  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mapping sensors and data with OpenLayers 3</a><ul>
<li><a class="reference internal" href="#practice-with-openlayers-3">Practice with OpenLayers 3</a></li>
<li><a class="reference internal" href="#loading-istsos-sensors-on-the-map">Loading istSOS sensors on the map</a></li>
<li><a class="reference internal" href="#changing-the-istsos-vector-layer-style">Changing the istSOS vector layer style</a></li>
<li><a class="reference internal" href="#adding-interaction-to-the-map-to-display-sensor-metadata">Adding interaction to the map to display sensor metadata</a></li>
<li><a class="reference internal" href="#plotting-measures-in-a-chart">Plotting measures in a chart</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ws_virtualprocedures.html"
                        title="previous chapter">Creating Virtual Procedures</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ws_mqtt.html"
                        title="next chapter">MQTT Broadcasting</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ws_mapping.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ws_mqtt.html" title="MQTT Broadcasting"
             >next</a> |</li>
        <li class="right" >
          <a href="ws_virtualprocedures.html" title="Creating Virtual Procedures"
             >previous</a> |</li>
        <li><a href="index.html">istSOS 2.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010-2017, Massimiliano Cannata, Milan Antonovic This work is licensed under a Creative Commons Attribution 4.0 International License.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>